{% extends "wms/index.html" %}
{% load crispy_forms_tags %}
 
{% block content %}
   <div class="row">
        <div class="col-sm-4 col-md-4">
            <div id="accordion" class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-target="#collapseBody">
                            Новый график<span class="pull-right"></span>
                        </a>
                    </h4>
                </div>
                <div id="collapseBody" class="panel-collapse collapse in">
                    <div class="panel-body">
                        {% crispy form %}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-8 col-md-8">
            <div id="accordion2" class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-target="#collapseBody">
                            Документы за период<span class="pull-right"></span>
                        </a>
                    </h4>
                </div>
                <div id="collapseBody2" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <div id="documents_over_period"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block extrajs %}
		<script src="http://code.highcharts.com/highcharts.js"></script>
		<script src="http://code.highcharts.com/modules/exporting.js"></script>
{% endblock %}


{% block script %}
    <script type="text/javascript">
        $(document).ready(function() {
            $('.datepicker').get().type ='date';

            $('#id_start_date').datetimepicker({
                pickTime: false
            });

            $('#id_end_date').datetimepicker({
                pickTime: false
            });
       });
    </script>
    <script type="text/javascript">
        var frm = $('#add_chart');
        var chartDataUrl = "{% url 'wms:add_chart' %}";
        frm.submit(function () {

            var documentsCount = {
                chart: {renderTo: 'documents_over_period', zoomType: 'x', spacingRight: 20},
                title: {text: '',x : -20},
                xAxis: {title: {text : 'Дата'}},
                yAxis: {title: {text: 'Плановое кол-во документов'}, plotLines: [{value: 0, width: 1,color: '#808080'}]},
                legend: {layout: 'vertical', align: 'right', verticalAlign: 'middle', borderWidth: 0},
                series : [ {}]
            };

                $.ajax({
                    type: frm.attr('method'),
                    url: chartDataUrl,
                    data: frm.serialize(),
                    success: function(data) {
                        documentsCount.xAxis.categories = data['dates'];
                        documentsCount.series[0].name = 'Заказы';
                        documentsCount.series[0].data = data['values'];
                        var chart = new Highcharts.Chart(documentsCount);
                    },
                    error: function(data) {
                        alert("Sorry, something went wrong!");
                    }
            });
            return false;
        });
    </script>

{% endblock %}